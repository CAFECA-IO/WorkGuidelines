# 0. 前言

Hello 我是Murky! 恭喜您加入ISunFa後端Team! 接下來我會為您介紹ISunFa的後端開發流程。
# 1. 前置作業

## 1.1 與設計師討論流程
在新功能開始設計的時候，要開發的需求會先提供給設計師端，並由設計師繪製 Wire frame 與 Mock Up，高度建議於這個階段後端參加或旁聽設計師的討論會議，這樣可以掌握新設計的邏輯與流程。

## 1.2 撰寫User Story
與設計師討論完流程之後可以開始寫 User Story，User Story 可以讓前、後端對新功能有共同的認識，並且可以讓設計師確認開發的功能沒有偏離設計的功能。

> [!note]
> User Story 可以參照：
> - 身為一個 `某種身分的使用者`
> - 我希望 `某個使用者想要做的事`
> - 所以我需要 `某個功能`

寫完 User Story 之後可以在 [ISunFa Wiki](https://github.com/CAFECA-IO/iSunFA/wiki/) (或是你正在執行的專案的wiki)新增一個`Page`之後貼在裡面。

接者將User Story 和 設計師再過一次，確認User Story沒有偏離設計初衷。

![](./後端生存指南img/後端生存指南-20241227153755632.png)

## 1.3 和前端過一次User Story

在設計師完成 **Mock Up** 後，建議召開會議，邀請設計師與前端共同檢視 **User Story**，確保設計師、前端與後端對於開發需求有一致的理解。具體流程如下：

1. **設計師與前端講解 Mock Up**  
    由設計師和前端共同說明 Mock Up 的主要功能，解釋設計細節及交互邏輯，確保各方對設計有清楚的認識。
2. **後端逐條介紹 User Story**  
    後端人員逐條說明 **User Story** 的內容。
3. **設計師與前端提供意見**  
    請設計師和前端根據 Mock Up 和 **User Story** 提出建議，進行修正或補充，以確保需求的完整性與可行性。

透過此流程，確保設計師、前端與後端對於開發目標及執行細節有共同理解，減少後續開發中的溝通成本及需求偏差。

## 1.4 根據 User Story 和 Mock Up 設計 API

> **提示**：1.4 和 1.5 的執行順序可以先與前端討論，因為前端可能會希望先規劃 Component。

在獲得 **User Story** 和 **Mock Up** 畫面後，可以根據這些文件設計所需的 API。對於常見的資源存取，可以採用基於 CRUD 的設計模式，通常包含以下五種 API：

- **List**：取得資源列表
- **Get one**：取得單一資源
- **Create**：創建新資源
- **Update**：更新資源
- **Delete**：標記資源為刪除（注意：`Delete` 並非真的刪除，而是為資源增加 `deletedAt` 的時間戳）

在規劃 API 時，可以（但不強制）參考以下表格進行填寫，目的是確保每個 **User Story** 都能對應到至少一個 API：

|功能名稱|功能描述|User Story 編號|涉及資料表|API|
|---|---|---|---|---|
|這邊使用 Pseudo 名稱即可 (ex: createVoucher)|簡單描述 API 功能 (ex: 創建傳票)|可以放 User Story 編號 (ex: 2.2.3-10)|ex: Voucher, Certificate|`POST /company/:companyId/voucher`|



## 1.5 請前端規劃 Component

> **提示**：建議先完成 **1.4 API 設計**，讓前端參考 API 討論 Component。

在這個階段，可以請前端依據 **1.4 API List** 規劃畫面需求，並召開會議確認以下事項：

1. **畫面需求確認**  
    前端釐清各頁面所需的Component，如果時間充足可以請前端列出Component需要的料 Interface。
2. **API 需求討論**  
    前端根據畫面設計，檢查現有 API 是否足夠，並確認需要新增或修改的 API。
3. **缺漏 API 回饋**  
    如果發現缺少 API，前端需將需求整理後告訴後端，後端將這些資料補充至 **1.4 API List** 中。
    


## 1.6 開會討論 API 的 Request 與 Response Interface

在前端確認 **Component** 之後，可以召開會議討論各個 API 的串接接口，主要針對以下四個項目進行決定：

|項目|說明|
|---|---|
|**Param**|URL 路徑參數，例如 `:companyId`，在 Next.js 中為 `[companyId]`，後端則透過 `req.query` 獲取。|
|**Query**|URL 查詢參數，例如 `?query1=xxx`，後端用 `req.query` 獲取。需要注意，後端接收到的值類型都是 `string`。|
|**Body**|在 `POST` 或 `PUT` 請求中，前端提供的數據由後端通過 `req.body` 獲取，類型為 `any`。|
|**Response JSON**|後端回傳的 JSON 格式。|

---

### 接口規範與實作

1. **定義 Response JSON 的 Interface**  
    討論完成後，應將 `Response JSON` 的接口建立在 `src/interface` 資料夾中。如果沒有相關的 TypeScript 文件，則自行創建。
    
2. **更佳實作方式**  
    若需要提高接口定義的一致性，可以先撰寫 **Zod Schema** 並使用以下方法確保與 TypeScript 接口一致：
    
    ```typescript
    type ISchema = z.infer<typeof schema>;
    ```
    
    （目前尚未採用此實作方式，但可作為未來改進方案。）
    

---

透過這樣的討論流程，可以確保前後端在 API 設計上的溝通清楚，減少串接問題，提高開發效率與可維護性。
